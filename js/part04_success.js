const part04_success = [
  {
    characters: [
      { name: 'ichiro', position: 'center', expression: 'waa' },
    ],
    speaker: {
      kor: '야마다 이치로',
      jpn: '山田一郎'
    },
    text: {
      kor: '...해냈다! 대단해, 쿠코! 한번만에!',
      jpn: '…やった！すげーな、空却！一回で！'
    }
  },
  {
    characters: [
      { name: 'ichiro', position: 'center', expression: 'gon' },
    ],
    speaker: {
      kor: '야마다 이치로',
      jpn: '山田一郎'
    },
    text: {
      kor: '나는 천장쳐서 겨우 얻었는데!',
      jpn: '俺なんて何回もやって、ようやく取れたんだぞ！'
    }
  },
  {
    characters: [
      { name: 'ichiro', position: 'left', expression: 'default' },
      { name: 'kuko', position: 'right', expression: 'hya' },
    ],
    speaker: {
      kor: '하라이 쿠코',
      jpn: '波羅夷 空却'
    },
    text: {
      kor: '햣하! 소승의 힘을 얕보지 말라고!',
      jpn: 'ヒャッハ！拙僧の力を侮るでないぞ！'
    }
  },
  {
    characters: [
      { name: 'ichiro', position: 'left', expression: 'default' },
      { name: 'kuko', position: 'right', expression: 'hya' },
    ],
    speaker: {
      kor: '하라이 쿠코',
      jpn: '波羅夷 空却'
    },
    text: {
      kor: '귀엽지않냐, 미니 이치로다!',
      jpn: 'これ可愛くね？ミニ一郎だ！'
    }
  },
  {
    characters: [
      { name: 'ichiro', position: 'left', expression: 'miso2' },
      { name: 'kuko', position: 'right', expression: 'hya' },
    ],
    speaker: {
      kor: '야마다 이치로',
      jpn: '山田一郎'
    },
    text: {
      kor: '귀, 귀엽다니...',
      jpn: 'か、かわいいって……'
    }
  },
  {
    characters: [
      { name: 'hitoya', position: 'center', expression: 'default' },
    ],
    speaker: {
      kor: '아마구니 히토야',
      jpn: '天国 獄'
    },
    text: {
      kor: '삼남.',
      jpn: '三男。'
    }
  },
  {
    characters: [
      { name: 'saburo', position: 'center', expression: 'ang2' },
    ],
    speaker: {
      kor: '야마다 사부로',
      jpn: '山田三郎'
    },
    text: {
      kor: '시,시끄러! 말 걸지마!',
      jpn: 'う、うるさい！話しかけんな！'
    }
  },
  {
    characters: [
      { name: 'jakurai', position: 'center', expression: 'default' },
    ],
    speaker: {
      kor: '진구지 쟈쿠라이',
      jpn: '神宮寺 寂雷'
    },
    text: {
      kor: '사부로 군의 실력으로 충분히 방해할 수 있었는데, 왜 하지 않았나요?',
      jpn: '三郎くんなら十分に妨害できたはずですが、どうしてやらなかったんですか？'
    }
  },
  {
    characters: [
      { name: 'saburo', position: 'center', expression: 'ang2' },
    ],
    speaker: {
      kor: '야마다 사부로',
      jpn: '山田三郎'
    },
    text: {
      kor: '쳇.',
      jpn: 'チッ。'
    }
  },
  {
    characters: [
      { name: 'saburo', position: 'center', expression: 'default' },
    ],
    speaker: {
      kor: '야마다 사부로',
      jpn: '山田三郎'
    },
    text: {
      kor: '이치형이 저렇게 기대하고 즐거워하는 표정을 짓고 있는데, 어떻게 방해해...',
      jpn: '一兄があんなに楽しみにして嬉しそうな顔してんのに、どうやって邪魔しろってんだよ……'
    }
  },
  {
    characters: [
      { name: 'saburo', position: 'center', expression: 'wakan2' },
    ],
    speaker: {
      kor: '야마다 사부로',
      jpn: '山田三郎'
    },
    text: {
      kor: '나도, 지로도 형의 저런 모습을 끌어내진 못해.',
      jpn: '僕も二郎も、一兄からあんな表情を引き出すことはできない。'
    }
  },
  {
    characters: [
      { name: 'saburo', position: 'center', expression: 'wakan' },
    ],
    speaker: {
      kor: '야마다 사부로',
      jpn: '山田三郎'
    },
    text: {
      kor: '이치형의 평범한 일상을 부수고 싶지 않았을 뿐이야.',
      jpn: '一兄の普通の日常を壊したくなかっただけだ。'
    }
  },
  {
    characters: [
      { name: 'saburo', position: 'center', expression: 'simu' },
    ],
    speaker: {
      kor: '야마다 사부로',
      jpn: '山田三郎'
    },
    text: {
      kor: '...내가 어떻게 그래.',
      jpn: '……僕にそんなこと、できるわけないだろ。'
    }
  },
  {
    characters: [
      { name: 'hitoya', position: 'center', expression: 'haa' },
    ],
    speaker: {
      kor: '아마구니 히토야',
      jpn: '天国 獄'
    },
    text: {
      kor: '그렇다니까, 이제 알았냐. 바보가.',
      jpn: 'そういうことだよ。今頃気づいたかよ、バーカ。'
    }
  },
  {
    characters: [
      { name: 'jakurai', position: 'center', expression: 'smile' },
    ],
    speaker: {
      kor: '진구지 쟈쿠라이',
      jpn: '神宮寺 寂雷'
    },
    text: {
      kor: '좋은 생각입니다, 사부로 군.',
      jpn: '良い考えです、三郎くん。'
    }
  },
  {
    characters: [
      { name: 'rei', position: 'center', expression: 'default' },
    ],
    speaker: {
      kor: '아마야도 레이',
      jpn: '天谷奴 零'
    },
    text: {
      kor: '뭐야, 사부로 너까지. 시시하구만.',
      jpn: 'なんだよ、三郎まで。つまんねえな。'
    }
  },
  {
    characters: [
      { name: 'hitoya', position: 'center', expression: 'hut' },
    ],
    speaker: {
      kor: '아마구니 히토야',
      jpn: '天国 獄'
    },
    text: {
      kor: '저 한사람 빼곤 다 정신을 차린 것 같네.',
      jpn: 'あの一人を除けば、みんな正気に戻ったようだな。'
    }
  },
  {
    next: 'finalNext'
  }
];


$(function () {
  const seenEndings = JSON.parse(localStorage.getItem('seenEndings') || '[]');
  const hasEnd05 = seenEndings.includes('end05');

		if (hasEnd05) {
			$('.skipBtn').show();
		} else {
			$('.skipBtn').hide();
		}

  initDialogue({ sectionSelector: '.part04_success', script: part04_success });
});

let isTransitioning = false;

$('.skipBtn').off('click').on('click', function() {
    
    if (isTransitioning) return;
    isTransitioning = true;

    const seen = JSON.parse(localStorage.getItem('seenEndings') || '[]');
    const all = ['end01', 'end02', 'end03', 'end04', 'end05'];
    const seenAll = all.every(id => seen.includes(id));
    finalNext = seenAll
      ? './game/part05_story_true.html'
      : './game/part05_story.html';

    $('.container-inner').fadeOut(300, function () {
      $('.container-inner').load(finalNext, function () {
        $('.container-inner').fadeIn(500);
        isTransitioning = false;
      });
    });
});